## this

### Types
ECMAScript的类型分为 1.语言类型 和 2.规范类型
- 语言类型就是我们常见的Undefined、Null、Boolean、String、Number和Object
- 规范类型是用来表述语言结构和语言类型的
   >- Reference, List, Completion, Property Descriptor, Property Identifier, Lexical Environment, 和 Environment Record
   >- 作用是用来描述 语言底层行为逻辑


### Reference
Reference由三个部分组成
- base value
- referenced name
- strict reference
---

- base value
> 就是属性所在的对象或者全局EnvironmentRecord，他的值只可能是 undefined, an Object, a Boolean, a String, a Number, or an environment record其中一种


- referenced name
> 就是属性的名称

#### 示例
```js
var foo = 1

// foo对应的Reference
var fooReference = {
    base：EnvironmentRecord,
    name:'foo',
    strict: false
}

---

var foo = {
    bar: function(){
        return this
    }
}

foo.bar() // foo

// bar对应的Reference
var barReference = {
    base：foo,
    name:'bar',
    strict: false
}
```

#### 获取Reference的方法：GetBase和IsPropertyReference

- GetBase 
返回reference的base value，内部使用GetValue返回对象属性真正的值

- IsPropertyReference
base value 是⼀个对象，就返回true

## 如果确定this值
- step1： 计算 MemberExpression 的结果赋值给 ref；
- step2： 判断 ref 是不是⼀个 Reference 类型
> - a: 如果 ref 是 Reference，并且 IsPropertyReference(ref) 是 true, 那么 this 的值为 GetBase(ref) 
> - b: 如果 ref 是 Reference，并且 base value 值是 Environment Record, 那么this的值为 ImplicitThisValue(ref)  
> - c: 如果 ref 不是 Reference，那么 this 的值为 undefined； 

## MemberExpression计算结果

```js
function foo() {
 console.log(this)
}
foo(); // MemberExpression 是 foo


function foo() {
 return function() {
 console.log(this)
 }
}
foo()(); // MemberExpression 是 foo()


var foo = {
 bar: function () {
 return this;
 }
}
foo.bar(); // MemberExpression 是 foo.bar
```

- 简单理解 MemberExpression 其实就是()左边的部分

### 示例
```js
var value = 1;

var foo = {
 value: 2,
 bar: function () {
    return this.value;
 }
}
console.log(foo.bar())   // 示例1
console.log((foo.bar = foo.bar)()) // 示例2
console.log((false || foo.bar)()) // 示例3
```

- 示例1 foo.bar()
1. 计算MemberExpression： MemberExpression = foo.bar
2. foo.bar是否是Reference 是的
```js
// bar的Reference 
var Reference = {
    base: foo,
    name: 'bar',
    strict: false
}
```
3. IsPropertyReference(ref) 是否为true
> IsPropertyReference(ref) 是否为true， 就看她的base value是否是一个对象，
> foo是一个函数对象，所以返回true
4. this的值就为 GetBase(ref) 既 foo， this指向foo

- 示例2 示例3
- (foo.bar = foo.bar)()
> - 1.计算MemberExpression, MemberExpression = (foo.bar = foo.bar)
> - 2. (foo.bar = foo.bar) 是否是Reference， 使用了赋值，即使用了GetValue()
> - 3. ref 不是 Reference, 那么this的值为undefined
> - 4. 代表如果在严格模式下为undefined，非严格模式下会转换成全局对象

- (false || foo.bar)()
> - 1.计算MemberExpression, MemberExpression = (false || foo.bar)
> - 2. (false || foo.bar) 是否是Reference， 使用了或运算，即使用了GetValue()
> - 3. ref 不是 Reference, 那么this的值为undefined
> - 4. 代表如果在严格模式下为undefined，非严格模式下会转换成全局对象