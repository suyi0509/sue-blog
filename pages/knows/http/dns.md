## DNS协议

> DNS,域名系统，是互联网一项服务，是进行域名和对应IP地址进行转换的服务器


- IP地址： 一长串能够唯一标记网络上计算机的数字
- 域名：是由一串用点分隔的名字组成的Internet上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识


### 域名
> 域名，是一个具有层次结构，从上开始 根域名、顶级域名、二级域名、三级域名、四级域名...

- www.xxx.com， **www**是三级域名、**xxx**是二级域名，**com**是顶级域名
- www.xxx.edu.cn  四级

### 域名缓存
在域名服务器解析时，使用缓存保存域名和IP地址的映射
计算机中DNS的记录分成两种缓存方式：
- 浏览器缓存：浏览器在获取网络域名的实际IP地址后会对其进行缓存，减少网络请求的损耗
- 操作系统缓存：操作系统的缓存其实是用户自己配置的hosts文件


### DNS查询方式
- 递归查询： 如果A请求B，那么B作为请求的接收者一定要给A想要的答案
1.本地域名服务器（A） -> 2.根域名服务器（B） -> 3.顶级域名服务器 -> 4.权限域名服务器 （找到为止） -> 5.权限域名服务器 -> 6.顶级域名服务器 -> 7.根域名服务器 -> 8.本地域名服务器 

- 迭代查询：如果接收者B没有请求者A所需要的准确内容，接收者B会将告诉A，如果去获取这个内容，自己并不会发送请求、
1. 本地域名服务器（A） -> 根域名服务器（B）
2. 根域名服务器（B） -> 本地域名服务器（A）
3. 本地域名服务器（A） -> 顶层域名服务器
4. 顶层域名服务器 -> 本地域名服务器（A）
5. 本地域名服务器（A） -> 权限域名服务器
6. 权限域名服务器 -> 本地域名服务器（A）


#### 查询过程
1. 搜索浏览器DNS缓存，缓存中维护一张域名和IP地址的对应表
2. 若没有命中，则继续搜索操作系统的DNS缓存
3. 若仍然没有命中，则操作系统将域名发送至本地域名服务器，本地域名服务器采用**递归查询**自己的DNS缓存，查找成功则返回结果
4. 若本地域名服务器的DNS缓存没有命中，则本地域名服务器会向上级域名服务器进行**迭代查询**
    - 首先本地域名服务器向根域名服务器发起请求，根域名服务器返回顶级域名服务器的地址给本地服务器
    - 本地域名服务器拿到这个顶级域名服务器地址后，就向其发起请求，获取权限域名服务器的地址
    - 本地域名服务器根据权限域名服务器地址向其发送请求，最终得到该域名对应的IP地址
5. 本地域名服务器将得到IP地址返回给操作系统，同时自己将IP地址缓存起来
6. 操作系统将IP地址返回给浏览器，同时自己也将IP地址缓存起
7. 浏览器得到域名对应的IP地址，并将IP地址缓存起